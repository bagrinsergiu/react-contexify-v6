import H, { createContext, useReducer, useRef, useState, useEffect, useContext, Children, cloneElement } from 'react';
import X from 'clsx';
import { flushSync } from 'react-dom';

var z=createContext({}),F=()=>useContext(z),$=t=>H.createElement(z.Provider,{...t});function le(){let t=new Map;return {on(e,r){return t.has(e)?t.get(e).add(r):t.set(e,new Set([r])),this},off(e,r){return t.has(e)&&t.get(e).delete(r),this},emit(e,r){return t.has(e)&&t.get(e).forEach(f=>{f(r);}),this}}}var R=le();var B=()=>useRef(new Map).current;var G=()=>{},U=["resize","contextmenu","click","scroll","blur"];var A={show({event:t,id:e,props:r,position:f}){t.preventDefault&&t.preventDefault(),R.emit(0).emit(e,{event:t.nativeEvent||t,props:r,position:f});},hideAll(){R.emit(0);}};function Fe(t){return {show(e){A.show({...t,...e});},hideAll(){A.hideAll();}}}function q(){let t=new Map,e,r,f,s,i=!1;function P(n){s=Array.from(n.values()),e=-1,f=!0;}function v(){s[e].node.focus();}let T=()=>e>=0&&s[e].isSubmenu,I=()=>Array.from(s[e].submenuRefTracker.values());function c(){return e===-1?(x(),!1):!0}function x(){e+1<s.length?e++:e+1===s.length&&(e=0),i&&a(),v();}function b(){e===-1||e===0?e=s.length-1:e-1<s.length&&e--,i&&a(),v();}function E(){if(c()&&T()){let n=I(),{node:l,setSubmenuPosition:h}=s[e];return t.set(l,{isRoot:f,focusedIndex:e,parentNode:r||l,items:s}),h(),l.classList.add("contexify_submenu-isOpen"),r=l,n.length>0?(e=0,s=n):i=!0,f=!1,v(),!0}return !1}function a(){if(c()&&!f){let n=t.get(r);r.classList.remove("contexify_submenu-isOpen"),s=n.items,r=n.parentNode,n.isRoot&&(f=!0,t.clear()),i||(e=n.focusedIndex,v());}}function y(n){function l(h){for(let o of h)o.isSubmenu&&o.submenuRefTracker&&l(Array.from(o.submenuRefTracker.values())),o.keyMatcher&&o.keyMatcher(n);}l(s);}return {init:P,moveDown:x,moveUp:b,openSubmenu:E,closeSubmenu:a,matchKeys:y}}function S(t){return typeof t=="function"}function V(t){return typeof t=="string"}function _(t,e){return Children.map(Children.toArray(t).filter(Boolean),r=>cloneElement(r,e))}function Q(t){let e={x:t.clientX,y:t.clientY},r=t.changedTouches;return r&&(e.x=r[0].clientX,e.y=r[0].clientY),(!e.x||e.x<0)&&(e.x=0),(!e.y||e.y<0)&&(e.y=0),e}function w(t,e){return S(t)?t(e):t}function xe(t,e){return {...t,...S(e)?e(t):e}}var it=({id:t,theme:e,style:r,className:f,children:s,animation:i="fade",preventDefaultOnKeydown:P=!0,disableBoundariesCheck:v=!1,onVisibilityChange:T,...I})=>{let[c,x]=useReducer(xe,{x:0,y:0,visible:!1,triggerEvent:{},propsFromTrigger:null,willLeave:!1}),b=useRef(null),E=B(),[a]=useState(()=>q()),y=useRef(),n=useRef();useEffect(()=>(R.on(t,h).on(0,o),()=>{R.off(t,h).off(0,o);}),[t,i,v]),useEffect(()=>{c.visible?a.init(E):E.clear();},[c.visible,a,E]);function l(u,p){if(b.current&&!v){let{innerWidth:d,innerHeight:C}=window,{offsetWidth:K,offsetHeight:O}=b.current;u+K>d&&(u-=u+K-d),p+O>C&&(p-=p+O-C);}return {x:u,y:p}}useEffect(()=>{c.visible&&x(l(c.x,c.y));},[c.visible]),useEffect(()=>{function u(d){P&&d.preventDefault();}function p(d){switch(d.key){case"Enter":case" ":a.openSubmenu()||o();break;case"Escape":o();break;case"ArrowUp":u(d),a.moveUp();break;case"ArrowDown":u(d),a.moveDown();break;case"ArrowRight":u(d),a.openSubmenu();break;case"ArrowLeft":u(d),a.closeSubmenu();break;default:a.matchKeys(d);break}}if(c.visible){b.current?.ownerDocument.addEventListener("keydown",p);for(let d of U)window.document.addEventListener(d,o);}return ()=>{b.current?.ownerDocument.removeEventListener("keydown",p);for(let d of U)window.document.removeEventListener(d,o);}},[c.visible,a,P]);function h({event:u,props:p,position:d}){u.stopPropagation();let C=d||Q(u),{x:K,y:O}=l(C.x,C.y);flushSync(()=>{x({visible:!0,willLeave:!1,x:K,y:O,triggerEvent:u,propsFromTrigger:p});}),clearTimeout(n.current),!y.current&&S(T)&&(T(!0),y.current=!0);}function o(u){u!=null&&(u.button===2||u.ctrlKey)&&u.type!=="contextmenu"||(i&&(V(i)||"exit"in i&&i.exit)?x(p=>({willLeave:p.visible})):x(p=>({visible:p.visible?!1:p.visible})),n.current=setTimeout(()=>{S(T)&&T(!1),y.current=!1;}));}function k(){c.willLeave&&c.visible&&flushSync(()=>x({visible:!1,willLeave:!1}));}function L(){return V(i)?X.clsx({[`${"contexify_willEnter-"}${i}`]:g&&!D,[`${"contexify_willLeave-"}${i} ${"contexify_willLeave-"}'disabled'`]:g&&D}):i&&"enter"in i&&"exit"in i?X.clsx({[`${"contexify_willEnter-"}${i.enter}`]:i.enter&&g&&!D,[`${"contexify_willLeave-"}${i.exit} ${"contexify_willLeave-"}'disabled'`]:i.exit&&g&&D}):null}let{visible:g,triggerEvent:m,propsFromTrigger:M,x:Y,y:ie,willLeave:D}=c,ae=X.clsx("contexify",f,{[`${"contexify_theme-"}${e}`]:e},L());return H.createElement($,{value:E},g&&H.createElement("div",{...I,className:ae,onAnimationEnd:k,style:{...r,left:Y,top:ie,opacity:1},ref:b,role:"menu"},_(s,{propsFromTrigger:M,triggerEvent:m})))};var pt=({id:t,children:e,className:r,style:f,triggerEvent:s,data:i,propsFromTrigger:P,keyMatcher:v,onClick:T=G,disabled:I=!1,hidden:c=!1,closeOnClick:x=!0,handlerEvent:b="onClick",...E})=>{let a=useRef(),y=F(),n={id:t,data:i,triggerEvent:s,props:P},l=w(I,n),h=w(c,n);function o(m){n.event=m,m.stopPropagation(),l||(x?k():T(n));}function k(){let m=a.current;m.focus(),m.classList.add("contexify_item-feedback");let M=()=>{setTimeout(A.hideAll,0);};window.getComputedStyle(m).animationName!=="none"?m.addEventListener("animationend",()=>M(),{once:!0}):M(),T(n);}function L(m){m&&!l&&(a.current=m,y.set(m,{node:m,isSubmenu:!1,keyMatcher:!l&&S(v)&&(M=>{v(M)&&(M.stopPropagation(),M.preventDefault(),n.event=M,k());})}));}function g(m){(m.key==="Enter"||m.key===" ")&&(m.stopPropagation(),n.event=m,k());}return h?null:H.createElement("div",{...E,[b]:o,className:X.clsx("contexify_item",r,{[`${"contexify_item-disabled"}`]:l}),style:f,onKeyDown:g,ref:L,tabIndex:-1,role:"menuitem","aria-disabled":l},H.createElement("div",{className:"contexify_itemContent"},e))};var Et=({triggerEvent:t,data:e,propsFromTrigger:r,hidden:f=!1})=>w(f,{data:e,triggerEvent:t,props:r})?null:H.createElement("div",{className:"contexify_separator"});var ne=()=>H.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},H.createElement("polyline",{points:"9 18 15 12 9 6"}));var oe=({className:t,...e})=>H.createElement("div",{className:X.clsx("contexify_rightSlot",t),...e});var Kt=({arrow:t,children:e,disabled:r=!1,hidden:f=!1,label:s,className:i,triggerEvent:P,propsFromTrigger:v,style:T,...I})=>{let c=F(),x=B(),b=useRef(null),E={triggerEvent:P,props:v},a=w(r,E),y=w(f,E);function n(){let o=b.current;if(o){let k=`${"contexify_submenu"}-bottom`,L=`${"contexify_submenu"}-right`;o.classList.remove(k,L);let g=o.getBoundingClientRect();g.right>window.innerWidth&&o.classList.add(L),g.bottom>window.innerHeight&&o.classList.add(k);}}function l(o){o&&!a&&c.set(o,{node:o,isSubmenu:!0,submenuRefTracker:x,setSubmenuPosition:n});}if(y)return null;let h=X.clsx("contexify_item",i,{[`${"contexify_item-disabled"}`]:a});return H.createElement($,{value:x},H.createElement("div",{...I,className:h,ref:l,tabIndex:-1,role:"menuitem","aria-haspopup":!0,"aria-disabled":a,onMouseEnter:n,onTouchStart:n},H.createElement("div",{className:"contexify_itemContent",onClick:o=>o.stopPropagation()},s,H.createElement(oe,null,t||H.createElement(ne,null))),H.createElement("div",{className:`${"contexify"} ${"contexify_submenu"}`,ref:b,style:T},_(e,{propsFromTrigger:v,triggerEvent:P}))))};

export { pt as Item, it as Menu, oe as RightSlot, Et as Separator, Kt as Submenu, A as contextMenu, Fe as useContextMenu };
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.mjs.map